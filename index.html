<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>HAVEN PAYLA≈ûIM</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 20px auto;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    h2 {
      margin: 0;
    }
    .button-link {
      background: #4CAF50;
      color: white;
      padding: 8px 16px;
      text-decoration: none;
      border-radius: 6px;
      font-weight: bold;
    }
    .button-link:hover {
      background: #45a049;
    }
    .server-item {
      border: 2px solid #2196F3;
      border-radius: 20px;
      padding: 15px;
      margin-bottom: 15px;
    }
    .server-header {
      font-weight: bold;
      font-size: 18px;
      color: #2196F3;
    }
    .server-link {
      color: #555;
      margin-top: 5px;
      display: block;
      word-break: break-word;
      text-decoration: none;
    }
    .server-link:hover {
      text-decoration: underline;
    }
    .comments-section {
      margin-top: 10px;
    }
    .comment {
      background: #f0f8ff;
      padding: 8px;
      border-radius: 8px;
      margin-bottom: 6px;
      position: relative;
    }
    .comment button {
      position: absolute;
      right: 8px;
      top: 8px;
      background: #e74c3c;
      border: none;
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
    }
    .vote-section {
      margin-top: 8px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .vote-btn {
      cursor: pointer;
      user-select: none;
      font-size: 20px;
    }
    .vote-count {
      font-weight: bold;
    }
  </style>
</head>
<body>

  <header>
    <h2>HAVEN PAYLA≈ûIM</h2>
    <a href="ekle.html" class="button-link">EKLE</a>
  </header>

  <div id="serversList"></div>

  <script>
    const SUPABASE_URL = 'https://iweymvclgbtmnaglvgzp.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml3ZXltdmNsZ2J0bW5hZ2x2Z3pwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg2MjMxNzUsImV4cCI6MjA2NDE5OTE3NX0.zBPxdiI_hyx_VfAL0d5OECAbKOewxQRTr5pli89xmT8';

    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const serversList = document.getElementById('serversList');

    async function loadServers() {
      serversList.innerHTML = 'Y√ºkleniyor...';
      const { data: servers, error } = await supabase
        .from('servers')
        .select('*')
        .order('created_at', { ascending: false });

      if (error) {
        serversList.innerHTML = 'Veri alƒ±nƒ±rken hata olu≈ütu.';
        console.error(error);
        return;
      }
      if (!servers.length) {
        serversList.innerHTML = '<p>Hen√ºz sunucu eklenmemi≈ü.</p>';
        return;
      }

      serversList.innerHTML = '';
      servers.forEach(server => {
        const div = document.createElement('div');
        div.className = 'server-item';

        const nameDiv = document.createElement('div');
        nameDiv.className = 'server-header';
        nameDiv.textContent = server.name;
        div.appendChild(nameDiv);

        const linkA = document.createElement('a');
        linkA.href = server.link;
        linkA.target = '_blank';
        linkA.className = 'server-link';
        linkA.textContent = server.link;
        div.appendChild(linkA);

        const voteCountKey = `vote_${server.id}`;
        const commentKey = `comment_${server.id}`;

        let voteCount = parseInt(localStorage.getItem(voteCountKey)) || 0;
        let userComment = localStorage.getItem(commentKey) || '';

        const voteSection = document.createElement('div');
        voteSection.className = 'vote-section';

        const btnUp = document.createElement('span');
        btnUp.className = 'vote-btn';
        btnUp.textContent = 'üëçüèª';
        btnUp.title = 'Oy Ver';

        const voteDisplay = document.createElement('span');
        voteDisplay.className = 'vote-count';
        voteDisplay.textContent = voteCount;

        const btnDown = document.createElement('span');
        btnDown.className = 'vote-btn';
        btnDown.textContent = 'üëéüèª';
        btnDown.title = 'Oy Kaldƒ±r';

        voteSection.appendChild(btnUp);
        voteSection.appendChild(voteDisplay);
        voteSection.appendChild(btnDown);

        div.appendChild(voteSection);

        const commentsSection = document.createElement('div');
        commentsSection.className = 'comments-section';

        if (userComment) {
          const commentDiv = document.createElement('div');
          commentDiv.className = 'comment';
          commentDiv.textContent = userComment;

          const delBtn = document.createElement('button');
          delBtn.textContent = 'X';
          delBtn.title = 'Yorumu Sil';
          delBtn.onclick = () => {
            if (confirm('Yorumu silmek istediƒüine emin misin?')) {
              localStorage.removeItem(commentKey);
              loadServers();
            }
          };
          commentDiv.appendChild(delBtn);
          commentsSection.appendChild(commentDiv);
        } else {
          const input = document.createElement('input');
          input.type = 'text';
          input.placeholder = 'Yorumunuzu yazƒ±n...';
          input.style.width = '80%';
          input.style.marginRight = '10px';

          const addCommentBtn = document.createElement('button');
          addCommentBtn.textContent = 'Yorum Ekle';

          addCommentBtn.onclick = () => {
            const val = input.value.trim();
            if (!val) {
              alert('L√ºtfen yorum yazƒ±n!');
              return;
            }
            localStorage.setItem(commentKey, val);
            loadServers();
          };

          commentsSection.appendChild(input);
          commentsSection.appendChild(addCommentBtn);
        }

        div.appendChild(commentsSection);

        btnUp.onclick = () => {
          if (voteCount === 0) {
            localStorage.setItem(voteCountKey, '1');
            loadServers();
          } else {
            alert('Zaten oy verdiniz!');
          }
        };
        btnDown.onclick = () => {
          if (voteCount === 1) {
            localStorage.setItem(voteCountKey, '0');
            loadServers();
          } else {
            alert('Hen√ºz oy vermediniz!');
          }
        };

        serversList.appendChild(div);
      });
    }

    loadServers();
  </script>

</body>
</html>
